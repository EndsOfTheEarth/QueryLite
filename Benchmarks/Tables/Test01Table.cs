namespace Benchmarks.Tables {
    using Microsoft.EntityFrameworkCore;
    using QueryLite;
    using System;
    using System.Collections.Generic;
    using System.ComponentModel;
    using System.ComponentModel.DataAnnotations;
    using System.ComponentModel.DataAnnotations.Schema;

    public sealed class Test01Table : ATable {

        public static readonly Test01Table Instance = new Test01Table();

        public Column<int> Id { get; }
        public Column<Guid> Row_guid { get; }
        public Column<string> Message { get; }
        public Column<DateTime> Date { get; }

        public override PrimaryKey? PrimaryKey => new PrimaryKey(table: this, name: "test01_pkey", Id);

        private Test01Table() : base(name: "test01", schemaName: "public") {

            Id = new Column<int>(this, name: "id", isAutoGenerated: true);
            Row_guid = new Column<Guid>(this, name: "row_guid");
            Message = new Column<string>(this, name: "message", length:  new ColumnLength(100));
            Date = new Column<DateTime>(this, name: "date");
        }
    }

    public sealed class Test01RowRepository : ARepository<Test01Table, Test01Row>, IRepository<Test01Table, Test01Row> {

        public Test01RowRepository() : base(Test01Table.Instance, matchOn: MatchOn.PrimaryKey) { }
    }

    public partial record class Test01Row : IRow<Test01Table, Test01Row> {

        [EditorBrowsable(EditorBrowsableState.Never)]
        public int InternalIndex { get; set; } = int.MaxValue;

        public int Id { get; set; }
        public Guid Row_guid { get; set; }
        public string Message { get; set; } = "";
        public DateTime Date { get; set; }        

        public Test01Row() { }

        public Test01Row(int id, Guid row_guid, string message, DateTime date) {
            Id = id;
            Row_guid = row_guid;
            Message = message;
            Date = date;
        }

        public void SetValues(int id, Guid row_guid, string message, DateTime date) {
            Id = id;
            Row_guid = row_guid;
            Message = message;
            Date = date;
        }

        public static Test01Row CloneRow(Test01Row row) => row with { };

        public static List<GetSetMap<Test01Row>> GetColumnMap(Test01Table table) =>
        [
            new GetSetMap<Test01Row>(table.Id, row => row.Id, (row, resultRow) => row.Id = resultRow.Get(table.Id), (Test01Row rowA, Test01Row rowB) => rowA.Id == rowB.Id),
            new GetSetMap<Test01Row>(table.Row_guid, row => row.Row_guid, (row, resultRow) => row.Row_guid = resultRow.Get(table.Row_guid), (Test01Row rowA, Test01Row rowB) => rowA.Row_guid == rowB.Row_guid),
            new GetSetMap<Test01Row>(table.Message, row => row.Message, (row, resultRow) => row.Message = resultRow.Get(table.Message), (Test01Row rowA, Test01Row rowB) => rowA.Message == rowB.Message),
            new GetSetMap<Test01Row>(table.Date, row => row.Date, (row, resultRow) => row.Date = resultRow.Get(table.Date), (Test01Row rowA, Test01Row rowB) => rowA.Date == rowB.Date)
        ];

        public static Test01Row LoadRow(Test01Table table, IResultRow resultRow) {

            Test01Row row = new Test01Row(
                id: resultRow.Get(table.Id),
                row_guid: resultRow.Get(table.Row_guid),
                message: resultRow.Get(table.Message),
                date: resultRow.Get(table.Date)
            );
            return row;
        }
    }

    [Table(name: "test01", Schema = "public")]
    public class Test01Row_EfCore {

        public Test01Row_EfCore() { }

        public Test01Row_EfCore(int id, Guid row_guid, string message, DateTime date) {
            Id = id;
            Row_guid = row_guid;
            Message = message;
            Date = date;
        }
        [Key]
        [Column(name: "id")]
        public int Id { get; set; }

        [Column(name: "row_guid")]
        public Guid Row_guid { get; set; }

        [Required]
        [Column(name: "message")]
        public string Message { get; set; } = "";

        [Column(name: "date")]
        public DateTime Date { get; set; }
    }

    public class TestContext : DbContext {

        private string ConnectionString { get; }

        public TestContext(string connectionString) {
            ConnectionString = connectionString;
        }

        public DbSet<Test01Row_EfCore> TestRows { get; set; } // Represents the Blogs table

        protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder) {
            optionsBuilder.UseNpgsql(ConnectionString);
        }
    }
}